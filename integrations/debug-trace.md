---
title: Дебаг & Трассировка
description:  Узнайте, как использовать Geth Debug API и модуль трассировки OpenEthereum на Moonbeam
---

# Дебаг API & Модуль Трассировки

![Full Node Moonbeam Banner](/images/debugtrace/debugtrace-banner.png)

## Вступление {: #introduction } 

Geth Дебаг API и модуль трассировки OpenEthereum обеспечивают нестандартные RPC методы для более глубокого понимания обработки транзакций.

С релизом Moonbase Alpha v7 сделан еще один шаг в достижении основной цели Moonbeam, а именно предоставлении беспрепятственного взаимодействия разработчиков с Ethereum:`debug_traceTransaction` и `trace_filter` RPC методы стали доступны.

Поддержка данных RPC методов является важнейшим этапом, ввиду того, что многие проекты, такие как [The Graph](https://thegraph.com/) и [Blockscout](https://docs.blockscout.com/), используют их для индексации блокчейн данных.

Оба запроса являются довольно тяжелыми, со стороны ноды. Поэтому требуется запустить этот RPC со стороны ноды при помощи команды `--ethapi=debug`, флаг для `debug_traceTransaction`и/или `--ethapi=trace` флаг для `trace_filter`. На данный момент Вы можете запустить 2 типа нод:

 - **Автономная нода Moonbeam** — запустите собственную копию Moonbeam в своей приватной среде. Для этого следуйте [этому руководству](/getting-started/local-node/setting-up-a-node/). Обязательно проверьте расширенные настройки [секции флагов](/getting-started/local-node/setting-up-a-node/#advanced-flags-and-options)
 - **Moonbase Alpha node** — запустите полную версию TestNet ноды и получите доступ к вашим приватным конечным точкам. Для этого следуйте [этому руководству](/node-operators/networks/full-node/). Обязательно проверьте расширенные настройки [advanced flags section](/node-operators/networks/full-node/#advanced-flags-and-options)

## Geth Дебаг API {: #geth-debug-api } 

RPC имплементация `debug_traceTransaction` следует [данному Geth гайдлайну по дебагу API](https://geth.ethereum.org/docs/rpc/ns-debug#debug_tracetransaction).

Для запуска RPC метода Вам понадобится hash транзакции, в качестве дополнительных параметров Вы можете указать следующее:

 - **disableStorage** — один ввод, boolean (по умолчанию: _false_). Установка значения True отключает захват хранилища
 - **disableMemory** — один ввод, boolean (по умолчанию: _false_). Установка значения True отключает захват памяти
 - **disableStack** — один ввод, boolean (по умолчанию: _false_). Установка значения True отключает захват стейка

На данный момент, трассировка транзакций на базе JavaScript не поддерживается.

## Модуль Трассировки {: #trace-module } 

RPC имплементация `trace_filter` следует [данному OpenEthereum гайдлайну Модуля Трассировки.](https://openethereum.github.io/JSONRPC-trace-module#trace_filter).

Для RPC метода необходим ввод одного из следующих необязательных параметров:

 - **fromBlock** — один ввод: номер блока (`hex`), `earliest` который является генезис блоком или `latest` (по умолчанию) последний-лучший доступный блок. Начальный блок трассировки
 - **toBlock** — один ввод: номер блока (`hex`), `earliest` который является генезис блоком или `latest` (по умолчанию) последний-лучший доступный блок. Конечный блок трассировки
 - **fromAddress** — один ввод: список адресов. Фильтрация транзакций происходит только по заданным списком адресам. Если данный список не указан/поле не заполнено, то фильтрация по нему не выполняется
 - **toAddress** — один ввод: список адресов. Фильтрация транзакций происходит только по заданным списком адресам. Если данный список не указан/поле не заполнено, то фильтрация по нему не выполняется
 - **after** — oодин ввод: офсет (`uint`), по умолчанию - `0`. Номер офсет трассировки (или начальный номер)
 - **count** — один ввод: количество трассировок (`uint`). Количество отображаемых трассировок в пакете

## Попробуем на Moonbase Alpha {: #try-it-on-moonbase-alpha } 

Как говорилось ранее, для использования обеих функций Вам необходимо запустить `debug` и `trace` флаги на Вашей ноде. В данном примере мы используем полную ноду Moonbase Alpha с RPC HTTP конечной точкой в `http://127.0.0.1:9933`. Если у Вас запущена нода Вы должны увидеть аналогичный лог в терминале:

![Debug API](/images/debugtrace/debugtrace-images1.png)

Например, для вызова `debug_traceTransaction` Вы можете сделать следующий JSON RPC запрос в терминале (в данном примере для хэша`0x04978f83e778d715eb074352091b2159c0689b5ae2da2554e8fe8e609ab463bf`):

```
curl http://localhost:9933 -H "Content-Type:application/json;charset=utf-8" -d \
  '{
    "jsonrpc":"2.0",
    "id":1,
    "method":"debug_traceTransaction",
    "params": ["0x04978f83e778d715eb074352091b2159c0689b5ae2da2554e8fe8e609ab463bf"]
  }'
```

На что нода ответит пошаговым воспроизведением информации о транзакции (ответ немного обрезан т.к. он достаточно длинный):

![Запуск ноды Trace Debug](/images/debugtrace/debugtrace-images2.png)

Для вызова `trace_filter` Вы можете сделать следующий JSON RPC запрос в терминале (в данном примере стоит фильтрация от блока 20000 до 25000, для транзакций где получателем является `0x4E0078423a39EfBC1F8B5104540aC2650a756577`, запрос начнется с нулевого офсета и предоставит первые 20 трассировок):

```
curl http://localhost:9933 -H "Content-Type:application/json;charset=utf-8" -d \
  '{
    "jsonrpc":"2.0",
    "id":1,
    "method":"trace_filter", "params":[{"fromBlock":"0x4E20","toBlock":"0x5014","toAddress":["0x4E0078423a39EfBC1F8B5104540aC2650a756577"],"after":0,"count":20}]
  }'
```

На что нода ответит информацией трассировки, соответствующей заданному фильтру (ответ немного обрезан т.к. он достаточно длинный).

![Запуск ноды Trace Filter](/images/debugtrace/debugtrace-images3.png)

