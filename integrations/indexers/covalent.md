title: Covalent API
description: Запрос данных блокчейна с помощью Moonbeam Covalent API
---

# Начало работы с Covalent API

![Graph на Moonbeam](/images/covalent/covalentbannerimage.png)

## Вступление

Covalent предоставляет унифицированный API для обеспечения полной прозрачности и обзора активов во всех блокчейн сетях. Проще говоря, Covalent предлагает единый API инструмент, который позволяет извлекать подробные, детализированные данные транзакций блокчейна из нескольких блокчейнов без использования кода. Унифицированный API от Covalent позволяет создавать совершенно новые приложения или дополнять существующие без настройки или обслуживания инфраструктуры. На текущий момент Covalent поддерживает Moonbase Alpha, также в будущем планируется поддержка Moonbeam и Moonriver.

## Проверка требований

Все запросы требуют аутентификации; Вам понадобится [API ключ](https://www.covalenthq.com/platform/#/auth/register/) для использования Covalent API. 
Также Вам понадобятся следующие компоненты:

 - Установленный Metamask [подключённый к Moonbase](/getting-started/moonbase/metamask/)
 - Иметь в наличии учётную запись, с денежными средствами которые Вы можете получить в [Центре управления](/getting-started/moonbase/faucet/)

## Типы конечных точек

Covalent API имеет два класса конечных точек:

 - **Класс A** — конечные точки, которые возвращают накопленные данные блокчейна, применимые ко всем блокчейн сетям, например: балансы, транзакции, журнал событий и т.д.
 - **Класс B** — конечные точки, которые предназначены для определенного протокола в блокчейне, например Uniswap предназначен только для Ethereum и не применим к другим блокчейн сетям.

## Основы Covalent API
 - Covalent API - это RESTful, и он разработан вокруг основных ресурсов, доступных через веб-интерфейс
 - Текущая версия API - версия 1
 - Возвращаемый формат по умолчанию для всех конечных точек - JSON
 - Все запросы требуют аутентификации; Вам понадобится [API ключ](https://www.covalenthq.com/platform/#/auth/register/) для использования Covalent API
 - Основной URL-адрес API: https://api.covalenthq.com/v1/ 
 - Все запросы выполняются с использованием протокола HTTPS (вызовы через протокол HTTP будут завершены с ошибкой)
 - Частота обновления API в реальном времени: 30 секунд или 2 блока и групповой 10 минут или 40 блоков 

## Поддерживаемые конечные точки
 - **Баланс** — Получение баланса токенов для адреса. Возвращает список всех остатков токенов ERC20 и NFT, включая ERC721 и ERC1155, а также их текущие спотовые цены (если доступны)
 - **Транзакции** — Извлекает все транзакции для адреса, включая декодированный журнал событий. Выполняет глубокое сканирование блокчейна, чтобы получить все транзакции, которые относятся к данному адресу
 - **Переводы** — Извлекает все транзакции для адреса включая историю цен токенов (если доступно)
 - **Владельцы токенов** — Возвращает список владельцев токенов с разбивкой на страницы
 - **Журнал событий (Смарт-Контракт)** — Возвращает разбитый на страницы список декодированных событий журнала, генерируемых конкретным смарт-контрактом.
 - **Журнал событий (Хеш Заголовка)** — Возвращает разбитый на страницы список декодированных событий журнала с одним или несколькими хешами заголовков, разделенными запятой


### Форматирование запроса
   | Конечная точка |     | Формат |
   | :---------- | :-: | :------------------- |
   |      Баланс       |     |          api.covalenthq.com/v1/1287/address/{address}/balances_v2/          |
   |      Транзакции       |     |           api.covalenthq.com/v1/1287/address/{address}/transactions_v2/|
   |      Переводы       |     |           api.covalenthq.com/v1/1287/address/{address}/transfers_v2/           |
   |      Владельцы токенов       |     |           api.covalenthq.com/v1/1287/tokens/{contract_address}/token_holders/           |
   |      Журнал событий (Смарт-Контракт)       |     |           api.covalenthq.com/v1/1287/events/address/{contract_address}/           |
   |      Журнал событий (Хеш Заголовка)      |     |           api.covalenthq.com/v1/1287/events/topics/{topic}/           |

## Практические действия
Во-первых, убедитесь, что у Вас есть [Ваш API-ключ](https://www.covalenthq.com/platform/#/auth/register/) который начинается с “ckey_”. Конечная точка владельцев токенов возвращает список всех держателей токенов определенного токена. Для этого API вызова Вам понадобится следующее: 

 - Ваш API Ключ
 - Идентификатор цепи Moonbase Alpha: 1287
 - Адрес контракта (Токен ERTH в этом примере): 0x08B40414525687731C23F430CEBb424b332b3d35

### Использование Curl
Попробуйте выполнить приведенную ниже команду в окне терминала после замены на Ваш API ключ.

```
curl https://api.covalenthq.com/v1/1287/tokens/\
0x08B40414525687731C23F430CEBb424b332b3d35/token_holders/ \
-u {YOUR API KEY HERE}:
```
!!! примечание
    Двоеточие `:` важно вставить после API ключа, так как в противном случае Вам будет предложено ввести пароль (который не требуется).


Covalent API вернет список владельцев токенов для токена EARTH. Если у Вас уже нет токенов ERTH, Ваш адрес будет отсутствовать в этом списке. Воспользуйтесь [Moonbase Alpha ERC-20 краном](https://moonbase-minterc20.netlify.app/) чтобы получить несколько токенов ERTH для себя. Теперь повторите тот же запрос Covalent API, как указано выше. Covalent API обновляется в режиме реального времени, так что теперь Вы должны увидеть свой адрес в списке держателей токена ERTH.

## Примеры Javascript
Скопируйте и вставьте приведенный ниже блок кода в предпочтительную среду, или [JSFiddle](https://jsfiddle.net/). После настройки API ключа, установите адрес ввиде константы. Помните, что идентификатор нашей цепи для Moonbase Alpha `1287`.

=== "Использование Fetch"
    ```js
    // установите свой API ключ 
	const APIKEY = 'Вставьте сюда Ваш API ключ';

	function getData() {
    const address = '0xFEC4f9D5B322Aa834056E85946A32c35A3f5aDD8'; //пример
    const chainId = '1287'; //Moonbeam Тестнет (Идентификатор цепи Moonbase Alpha)
    const url = new URL(`https://api.covalenthq.com/v1/${chainId}/address/${address}/balances_v2/`);
    
    url.search = new URLSearchParams({
        key: APIKEY
    })

    // используйте API-интерфейс fetch для получения данных Covalent
    fetch(url)
    .then((resp) => resp.json())
    .then(function(data) {
        const result = data.data;
  
        console.log(result)
        return result
        }
	)}

    getData();
    ```

=== "Using Async"
    ```js
    // установите свой ключ API
    const APIKEY = 'Вставьте сюда свой API ключ';
	const address = '0xFEC4f9D5B322Aa834056E85946A32c35A3f5aDD8'; //пример
	const chainId = '1287'; //Moonbeam Тестнет (Идентификатор цепи Moonbase Alpha)
	const url = new URL(`https://api.covalenthq.com/v1/${chainId}/address/${address}/balances_v2/`);

    url.search = new URLSearchParams({
        key: APIKEY
    })

    async function getData() {
    	const response = await fetch(url);
    	const result = await response.json();
    	console.log(result)
    	return result;
	}

	getData();

    ```

Результат должен быть похож на тот, что указан ниже. Конечная точка отвечающая за баланс вернёт количество всех токенов ERC20 и NFT, включая ERC721 и ERC1155, вместе с их текущими спотовыми ценами (если они доступны).

![Вывод консоли Javascript](/images/covalent/covalentjs.png)

## Пример Python
У Covalent нет официальной оболочки API. Чтобы запросить API напрямую, Вам нужно будет использовать [библиотеку запросов](https://pypi.org/project/requests/) Python. С помощью команды `pip install requests` Вы можете выполнять утсановку запросов в своей среде. Затем импортировать его и используйте в своем коде. Используйте методы get HTTP-команды для получения информации из API. Скопируйте и вставьте приведенный ниже блок кода в предпочитаемую среду и запустите его. Результат должен выглядеть примерно так, как показано на скриншоте выше, однако форматирование может отличаться в зависимости от среды которую Вы используете.

```python
import requests

def fetch_wallet_balance(address):
	api_url = 'https://api.covalenthq.com'
    endpoint = f'/v1/1287/address/{address}/balances_v2/'
    url = api_url + endpoint
    r = requests.get(url, auth=('YOUR API KEY HERE',''))
    print(r.json())
    return(r.json())

# Пример запроса адреса
fetch_wallet_balance('0xFEC4f9D5B322Aa834056E85946A32c35A3f5aDD8')

```

!!! примечание
    2-й параметр `auth` пустой, потому что пароль не требуется - так как в данном случае Ваш API ключ - это все, что требуется.

### Библиотеки Созданные Сообществом
В настоящее время у Covalent есть библиотеки на Python, Node, и Go, которые создаются и поддерживаются сообществом как часть [Программы Covalent Alchemists](https://www.covalenthq.com/ambassador/). Инструменты были созданы сообществом, чтобы предоставить пользователям Covalent API [доступные здесь](https://www.covalenthq.com/docs/tools/community).

!!! примечание
    Примечание: Эти инструменты НЕ поддерживаются Covalent, поэтому пользователям необходимо проявлять все меры предосторожности во время оценки этих инструментов, прежде чем использовать их в своих проектах.
